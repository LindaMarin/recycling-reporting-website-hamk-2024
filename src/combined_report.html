<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recycling Reporting</title>
    <link rel="stylesheet" href="../parts/global.css" />
    <!-- Initial CSS for Step 1 -->
    <link
      class="dynamic-css"
      rel="stylesheet"
      href="../parts/style-step1.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <!-- For icons -->
    <script src="../js/language.js"></script>
    <!-- Shared language script -->
    <style>
      .step {
        display: none;
      }
      .step.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="language-switcher">
      <button onclick="setLanguage('en')">English</button>
      <p>|</p>
      <button onclick="setLanguage('fi')">Suomi</button>
    </div>
    <div class="navbar">
      <ul>
        <li><a id="homeLink" href="../index.html">Home</a></li>
        <li><a id="learnLink" href="../src/learn.html">Learn</a></li>
        <li>
          <a id="statusMapLink" href="../src/status_map.html">Status map</a>
        </li>
        <li>
          <a
            id="combinedReportLink"
            href="../src/combined_report.html"
            class="active"
            >Reporting</a
          >
        </li>
      </ul>
      <div class="user-icon">
        <img src="../parts/user_app_basic_icon.png" alt="User Icon" />
      </div>
    </div>

    <!-- Step 1 -->
    <div id="step1" class="step active">
      <div class="container">
        <i
          class="fas fa-question-circle question-mark"
          onclick="toggleInstructions(1)"
        ></i>
        <h3 id="header_step1">Location of recycling area</h3>
        <div class="address">
          <input type="text" id="addressInput" class="textbox" readonly />
          <div class="centered-medium-text">
            <span id="addressInfo"
              >If the address above is not the address of recycling area,
              choose it from below</span
            >
          </div>
          <div class="arrow-down">
            <span>&#x2193;</span>
          </div>
          <select class="textbox" id="addressDropdown">
            <option id="selectAddress" value="">Select an address</option>
            <option value="address2">Street xx, 13100 Hml</option>
            <option value="address3">Street xx, 13100 Hml</option>
            <option value="address4">Street xx, 13100 Hml</option>
          </select>
        </div>
        <div class="action">
          <div class="previous-button">
            <img src="../parts/left_arrow_icon.png" alt="Previous" />
          </div>
          <div class="next-button">
            <img
              src="../parts/right_arrow_icon.png"
              alt="Next"
              onclick="nextStep(1)"
            />
          </div>
        </div>
      </div>
      <!-- Instructions Overlay for Step 1 -->
      <div class="instructions-overlay" id="instructions-overlay-step1">
        <div class="instructions-box">
          <span class="close-button" onclick="toggleInstructions(1)">×</span>
          <p>
            <b id="step1InstructionsTitle"
              >Instructions for submitting issues:</b
            >
          </p>
          <ol>
            <li id="step1Instruction1">
              If you used a QR-code to access this reporting page, the address
              should be correct.
            </li>
            <li id="step1Instruction2">
              But if you came through the website, choose the correct address
              from below.
            </li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Step 2 -->
    <div id="step2" class="step">
      <div class="container">
        <h3 id="header_step2">Select all the categories you wish to report on.</h3>
        <i
          class="fas fa-question-circle question-mark"
          onclick="toggleInstructions(2)"
        ></i>
        <div class="btn-group">
          <div class="dropdown">
            <button id="wasteSortingArea" class="dropbtn">
              Waste sorting area
            </button>
            <div class="dropdown-content">
              <button
                id="step2issue1"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Equipment
              </button>
              <button
                id="step2issue2"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Ventilation
              </button>
              <button
                id="step2issue3"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Doors
              </button>
              <button
                id="step2issue4"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Floor
              </button>
              <button
                id="step2issue5"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Accessibility
              </button>
              <button
                id="step2issue6"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Distances
              </button>
              <button
                id="step2issue7"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Lighting
              </button>
              <button
                id="step2issue8"
                onclick="changeColor(this, 'Waste sorting area')"
              >
                Signage
              </button>
            </div>
          </div>

          <div class="dropdown">
            <button id="generalCleanliness" class="dropbtn">
              General cleanliness
            </button>
            <div class="dropdown-content">
              <button
                id="step2issue9"
                onclick="changeColor(this, 'General cleanliness')"
              >
                Cleanliness
              </button>
              <button
                id="step2issue10"
                onclick="changeColor(this, 'General cleanliness')"
              >
                Unwanted Animals
              </button>
            </div>
          </div>

          <div class="dropdown">
            <button id="wasteBins" class="dropbtn">Waste bins</button>
            <div class="dropdown-content">
              <button
                id="step2issue11"
                onclick="changeColor(this, 'Waste bins')"
              >
                Placement
              </button>
              <button
                id="step2issue12"
                onclick="changeColor(this, 'Waste bins')"
              >
                Filling Levels
              </button>
              <button
                id="step2issue13"
                onclick="changeColor(this, 'Waste bins')"
              >
                Quantity
              </button>
              <button
                id="step2issue14"
                onclick="changeColor(this, 'Waste bins')"
              >
                Signage
              </button>
            </div>
          </div>
        </div>

        <!-- Area to display clicked button text -->
        <div id="selected-items">
          <h3 id="selectedIssuesTitle">Selected:</h3>
          <ul id="selected-list"></ul>
        </div>

        <!-- Action Buttons Centered Below Content -->
        <div class="action">
          <div class="previous-button">
            <img
              src="../parts/left_arrow_icon.png"
              alt="Previous"
              onclick="prevStep(2)"
            />
          </div>
          <div class="next-button">
            <img
              src="../parts/right_arrow_icon.png"
              alt="Next"
              onclick="nextStep(2)"
            />
          </div>
        </div>
      </div>

      <!-- Instructions Overlay for Step 2 -->
      <div class="instructions-overlay" id="instructions-overlay-step2">
        <div class="instructions-box">
          <span class="close-button" onclick="toggleInstructions(2)">×</span>
          <p>
            <b id="step2InstructionsTitle"
              >Instructions for submitting issues:</b
            >
          </p>
          <ol>
            <li id="step2Instruction1" style="padding-bottom: 10px;">
              Hover over a category from the three available options.
            </li>
            <li id="step2Instruction2" style="padding-bottom: 10px;">
              A dropdown menu will appear, click on faced issues.
            </li>
            <li id="step2Instruction3" style="padding-bottom: 10px;">
              All chosen issues will be listed below category buttons.
            </li>
            <li id="step2Instruction4" style="padding-bottom: 10px;">
              Repeat the process for other categories as needed.
            </li>
            <li id="step2Instruction5" style="padding-bottom: 10px;">
              Once all appropriate issues have been listed, click "Next" to
              proceed to the next step.
            </li>
          </ol>
        </div>
      </div>
    </div>

    <!-- Step 3 (Updated from report_step3.html) -->
    <div id="step3" class="step">
      <div class="container">
        <h3 id="step3Title">Enter issue details </h3>
        <div class="info">
            <i class="fas fa-question-circle question-mark" onclick="toggleInstructions(3)"></i>
        </div>

        <div class="input-box">
            <div class="cat-options">
                <button id="step3option1" class="option-button" onclick="selectOption(this)">
                    Full bins <i class="fas fa-arrow-right"></i>
                </button>
                <button id="step3option2" class="option-button" onclick="selectOption(this)">
                    Cleanliness <i class="fas fa-arrow-right"></i>
                </button>
                <button id="step3option3" class="option-button" onclick="selectOption(this)">
                    Miss sorted waste <i class="fas fa-arrow-right"></i>
                </button>
                <button id="step3option4" class="option-button" onclick="selectOption(this)">
                    Labels not visible <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div class="dynamic-content">
                <div id="messageBox" class="message-box">
                    <h3 id="step3DynamicHeading">Please select a category on the left to input issue details</h3>
                    <div class="instructions-overlay" id="instructions-overlay-step3">
                        <div class="instructions-box">
                            <span class="close-button" onclick="toggleInstructions(3)">×</span>
                            <p><b id="step3InstructionsTitle">Instructions for submitting issues:</b></p>
                            <ol> 
                                <li id="step3Instruction1">Select a category from the available options (e.g. Full bins, Cleanliness).</li>
                                <li id="step3Instruction2">Add relevant images either by choosing the Camera or Gallery buttons.</li>
                                <li id="step3Instruction3">Type issue details in the description section.</li>
                                <li id="step3Instruction4">Repeat the process for other categories as needed.</li>
                                <li id="step3Instruction5">Once done, click the right arrow to proceed to the next step.</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div id="contentContainer" style="display: none;">
                    <div class="upload-title" id="step3UploadTitle">Take photos via camera or browse gallery to upload</div>
                    <div class="upload-column">
                        <div class="upload-buttons">
                            <label class="upload-button">
                                <i class="fas fa-camera"></i>
                                <input type="file" accept="image/*" capture="camera" style="display: none;" />
                            </label>
                            <label class="upload-button">
                                <i class="fas fa-image"></i>
                                <input type="file" accept="image/*" style="display: none;" />
                            </label>
                        </div>
                    </div>
                    <div class="text-content">
                        <textarea rows="5" maxlength="1000" id="step3DescriptionPlaceholder" placeholder="Describe the issue here..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action">
          <div class="previous-button">
            <img
              src="../parts/left_arrow_icon.png"
              alt="Previous"
              onclick="prevStep(3)"
            />
          </div>
          <div class="next-button">
            <img
              src="../parts/right_arrow_icon.png"
              alt="Next"
              onclick="nextStep(3)"
            />
          </div>
        </div>
      </div>
    </div>

    <!-- Step 4 (Updated from report_step4.html) -->
    <div id="step4" class="step">
      <div class="container">
        <div class="input-box">
          <h3 id="step4Title">Send the report</h3>
          <div class="main-text" id="step4SubmissionMethod">
            How would you like to submit this report?
          </div>
          <ul class="options">
            <li>
              <div class="radio-option">
                <input
                  type="radio"
                  id="registered"
                  name="report"
                  value="registered"
                />
                <label for="registered" id="step4Option1"
                  >As a registered user</label
                >
              </div>
              <div class="description">
                <p id="step4Option1Description">
                  Your username will be publicly visible and your address will
                  be shared with the receiving organization.
                </p>
              </div>
            </li>
            <li>
              <div class="radio-option">
                <input
                  type="radio"
                  id="anonymous"
                  name="report"
                  value="anonymous"
                />
                <label for="anonymous" id="step4Option2">As an anonymous</label>
              </div>
              <div class="description">
                <p id="step4Option2Description">
                  No account required. This request will be sent to the
                  receiving organization but you will not receive updates.
                </p>
              </div>
            </li>
            <li>
              <div class="radio-option">
                <input type="radio" id="hide" name="report" value="hide" />
                <label for="hide" id="step4Option3"
                  >Hide your personal information</label
                >
              </div>
              <div class="description">
                <p id="step4Option3Description">
                  Your username and address will not be public and will be
                  hidden from the receiving organization.
                </p>
              </div>
            </li>
          </ul>

          <div class="action">
            <div class="previous-button">
              <img
                src="../parts/left_arrow_icon.png"
                alt="Previous"
                onclick="prevStep(4)"
              />
            </div>
            <div class="finish-next">
              <div class="finish-text" id="step4FinishText">FINISH</div>
              <div class="next-button">
                <img
                  src="../parts/right_arrow_icon.png"
                  alt="Next"
                  onclick="nextStep(4)"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Step 5, confirmation -->
    <div id="step5" class="step">
      <div class="container">
        <h1 id="step5ThankYou">Thank you for reporting!</h1>
        <div class="return_home">
          <a class="button" href="../index.html" id="returnHome" style="text-decoration: none;">
            Return to home page</a>
        </div>
      </div>
    </div>

    <div class="footer" id="footerText">Footer</div>

    <script>
      function updateStepCSS(stepNumber) {
        // Get the <link> element that dynamically changes
        const cssLink = document.querySelector(".dynamic-css");

        // Build the new href based on the step number
        let newHref;
        switch (stepNumber) {
          case 1:
            newHref = "../parts/style-step1.css";
            break;
          case 2:
            newHref = "../parts/style_step2.css";
            break;
          case 3:
            newHref = "../parts/style_step3.css";
            break;
          case 4:
            newHref = "../parts/style-step4.css";
            break;
          case 5:
            newHref = "../parts/confirmation.css";
            break;
          default:
            newHref = "../parts/global.css"; // Fallback
        }

        // Update the href attribute to point to the new stylesheet
        cssLink.href = newHref;
      }

      function nextStep(currentStep) {
        const nextStepElement = document.getElementById(
          `step${currentStep + 1}`
        );
        if (nextStepElement) {
          document
            .getElementById(`step${currentStep}`)
            .classList.remove("active");
          nextStepElement.classList.add("active");

          updateStepCSS(currentStep + 1); // Update the CSS for the next step

                // Call updateContent() to apply translations to the newly active step
                updateContent();
                reinitializeEventListeners(); // Reattach event listeners

            }
        }

      function prevStep(currentStep) {
        const prevStepElement = document.getElementById(
          `step${currentStep - 1}`
        );
        if (prevStepElement) {
          document
            .getElementById(`step${currentStep}`)
            .classList.remove("active");
          prevStepElement.classList.add("active");

          updateStepCSS(currentStep - 1); // Update the CSS for the previous step

                // Call updateContent() to apply translations to the newly active step
                updateContent();
                reinitializeEventListeners(); // Reattach event listeners
            }
        }


      function changeColor(button, category) {
        button.classList.toggle("clicked"); // Toggle the color change

        const selectedList = document.getElementById("selected-list");
        const buttonText = `${category} - ${button.innerText}`; // Combine category and button text

        if (button.classList.contains("clicked")) {
          // If clicked, add the text
          const listItem = document.createElement("li");
          listItem.textContent = buttonText;
          listItem.setAttribute("id", buttonText); // Use combined text as unique ID
          selectedList.appendChild(listItem);
        } else {
          // If unclicked, remove the text
          const listItem = document.getElementById(buttonText);
          if (listItem) {
            selectedList.removeChild(listItem);
          }
        }
      }

      function toggleInstructions(step) {
          const overlay = document.getElementById(`instructions-overlay-step${step}`);
          overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';

          // Apply translations after the instructions are shown
          updateContent();
      }

      // Step 3 functions
      function selectOption(selectedButton) {
          const buttons = document.querySelectorAll('.option-button');
          
          buttons.forEach(button => {
              button.classList.remove('active');
              const icon = button.querySelector('i');
              if (icon) {
                  icon.classList.replace('fa-arrow-left', 'fa-arrow-right');
              }
          });
          
          selectedButton.classList.add('active');
          const selectedIcon = selectedButton.querySelector('i');
          if (selectedIcon) {
              selectedIcon.classList.replace('fa-arrow-right', 'fa-arrow-left');
          }
          
          const selectedOptionText = selectedButton.textContent.trim();
          document.getElementById('step3DynamicHeading').textContent = `Selected Option: ${selectedOptionText}`;
          document.getElementById('contentContainer').style.display = 'block';
          document.getElementById('messageBox').classList.add('selected');
      }

      window.addEventListener("load", function () {
        const urlHash = window.location.hash;
        if (urlHash) {
          const address = decodeURIComponent(urlHash.substring(1));
          const addressInput = document.getElementById("addressInput");
          addressInput.value = address;
        } else {
          const addressInput = document.getElementById("addressInput");
          addressInput.value = "Street xx, 13100 Hml"; // Default value
        }
            reinitializeEventListeners();

      });
    </script>
  </body>
</html>
