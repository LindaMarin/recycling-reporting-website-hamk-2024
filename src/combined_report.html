<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recycling Reporting</title>
    <link rel="stylesheet" href="../parts/global.css">
    <link class="dynamic-css" rel="stylesheet" href="../parts/style-step1.css"> <!-- Initial CSS for Step 1 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"> <!-- For icons -->
    <script src="../js/language.js"></script> <!-- Shared language script -->
    <style>
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="language-switcher">
        <button onclick="setLanguage('en')">English</button>
        <button onclick="setLanguage('fi')">Suomi</button>
    </div>
    <div class="navbar">
        <ul>
            <li><a id="homeLink" href="../index.html">Home</a></li>
            <li><a id="learnLink" href="../src/learn.html">Learn</a></li>
            <li><a id="statusMapLink" href="../src/status_map.html">Status map</a></li>
            <li><a id="reportLink" href="../src/combined_report.html" class="active">Reporting</a></li>
        </ul>
        <div class="user-icon">
            <img src="../parts/user_app_basic_icon.png" alt="User Icon" />
        </div>
    </div>

    <!-- Step 1 -->
    <div id="step1" class="step active">
        <div class="container">
            <i class="fas fa-question-circle question-mark" onclick="toggleInstructions(1)"></i>

            <div class="address">
                <input type="text" id="addressInput" class="textbox" readonly>
                <div class="centered-medium-text">
                    <span id="addressInfo">If the address above is not the address of<br>recycling area, choose it from below</span>
                </div>
                <div class="arrow-down">
                    <span>&#x2193;</span>
                </div>
                <select class="textbox" id="addressDropdown">
                    <option id="selectAddress" value="">Select an address</option>
                    <option value="address2">Street xx, 13100 Hml</option>
                    <option value="address3">Street xx, 13100 Hml</option>
                    <option value="address4">Street xx, 13100 Hml</option>
                </select>
            </div>
            <div class="action">
                <div class="next-button">
                    <img src="../parts/right_arrow_icon.png" alt="Next" onclick="nextStep(1)" />
                </div>
            </div>
        </div>
        <!-- Instructions Overlay for Step 1 -->
        <div class="instructions-overlay" id="instructions-overlay-step1">
            <div class="instructions-box">
                <span class="close-button" onclick="toggleInstructions(1)">×</span>
                <p><b id="step1InstructionsTitle">Instructions for submitting issues:</b></p>
                <ol> 
                    <li>If you used a QR-code to access this reporting page, the address should be correct.</li>
                    <li>But if you came through the website, choose the correct address from below.</li>
                </ol>
            </div>
        </div>

    </div>


    <!-- Step 2 -->
    <div id="step2" class="step">
        <div class="container">
            <i class="fas fa-question-circle question-mark" onclick="toggleInstructions(2)"></i>
            <div class="btn-group">
                <div class="dropdown">
                    <button class="dropbtn">Waste sorting area</button>
                    <div class="dropdown-content">
                        <button onclick="changeColor(this, 'Waste sorting area')">Equipment</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Ventilation</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Doors</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Floor</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Accessibility</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Distances</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Lighting</button>
                        <button onclick="changeColor(this, 'Waste sorting area')">Signage</button>
                    </div>
                </div>
    
                <div class="dropdown">
                    <button class="dropbtn">General cleanliness</button>
                    <div class="dropdown-content">
                        <button onclick="changeColor(this, 'General cleanliness')">Cleanliness</button>
                        <button onclick="changeColor(this, 'General cleanliness')">Unwanted Animals</button>
                    </div>
                </div>
    
                <div class="dropdown">
                    <button class="dropbtn">Waste bins</button>
                    <div class="dropdown-content">
                        <button onclick="changeColor(this, 'Waste bins')">Placement</button>
                        <button onclick="changeColor(this, 'Waste bins')">Filling Levels</button>
                        <button onclick="changeColor(this, 'Waste bins')">Quantity</button>
                        <button onclick="changeColor(this, 'Waste bins')">Signage</button>
                    </div>
                </div>
            </div>
    
            <!-- Area to display clicked button text -->
            <div id="selected-items">
                <h3>Selected Issues:</h3>
                <ul id="selected-list"></ul>
            </div>
    
            <!-- Action Buttons Centered Below Content -->
            <div class="action">
                <div class="previous-button">
                    <img src="../parts/left_arrow_icon.png" alt="Previous" onclick="prevStep(2)"/>
                </div>
                <div class="next-button">
                    <img src="../parts/right_arrow_icon.png" alt="Next" onclick="nextStep(2)"/>
                </div>
            </div>
        </div>

        <!-- Instructions Overlay for Step 2 -->
        <div class="instructions-overlay" id="instructions-overlay-step2">
            <div class="instructions-box">
                <span class="close-button" onclick="toggleInstructions(2)">×</span>
                <p><b>Instructions for submitting issues:</b></p>
                <ol> 
                    <li>1. Hover over a category from the three available options.</li>
                    <li>2. A dropdown menu will appear, click on faced issues.</li>
                    <li>3. All chosen issues will be listed below category buttons.</li>
                    <li>4. Repeat the process for other categories as needed.</li>
                    <li>5. Once all appropriate issues have been listed, click "Next" to proceed to the next step.</li>
                </ol>
            </div>
        </div>

    </div>


    <!-- Step 3 (Updated from report_step3.html) -->
    <div id="step3" class="step">
        <div class="container">
            <div class="info">
                <i class="fas fa-question-circle question-mark" onclick="toggleInstructions(3)"></i>
            </div>

            <div class="input-box">
                <div class="cat-options">
                    <button id="fullbin" class="option-button" onclick="selectOption(this)">Full bins <i class="fas fa-arrow-right"></i></button>
                    <button id="cleanliness" class="option-button" onclick="selectOption(this)">Cleanliness <i class="fas fa-arrow-right"></i></button>
                    <button id="misssortedwaste" class="option-button" onclick="selectOption(this)">Miss sorted waste <i class="fas fa-arrow-right"></i></button>
                    <button id="labelsnotvisible" class="option-button" onclick="selectOption(this)">Labels not visible <i class="fas fa-arrow-right"></i></button>
                </div>
                <div class="dynamic-content">
                    <div id="messageBox" class="message-box">
                        <h3 id="dynamicHeading">Please select a category on the left to input issue details</h3>
                        <div class="instructions-overlay" id="instructions-overlay-step3">
                            <div class="instructions-box">
                                <span class="close-button" onclick="toggleInstructions(3)">×</span>
                                <p><b>Instructions for this step:</b></p>
                                <ol> 
                                    <li>Select a category from the available options (e.g. Full bins, Cleanliness).</li>
                                    <li>Add relevant images either by choosing the Camera or Gallery buttons.</li>
                                    <li>Type issue details in the description section.</li>
                                    <li>Repeat the process for other categories as needed.</li>
                                    <li>Once done, click the right arrow to proceed to the next step.</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    <div id="contentContainer" style="display: none;">
                        <div class="upload-title">Take photos via camera or browse gallery to upload</div>
                        <div class="upload-column">
                            <div class="upload-buttons">
                                <label class="upload-button">
                                    <i class="fas fa-camera"></i>
                                    <input type="file" accept="image/*" capture="camera" style="display: none;" />
                                </label>
                                <label class="upload-button">
                                    <i class="fas fa-image"></i>
                                    <input type="file" accept="image/*" style="display: none;" />
                                </label>
                            </div>
                        </div>
                        <div class="text-content">
                            <textarea rows="5" maxlength="1000" placeholder="Describe the issue here..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action">
                <div class="previous-button">
                    <img src="../parts/left_arrow_icon.png" alt="Previous" onclick="prevStep(3)" />
                </div>
                <div class="next-button">
                    <img src="../parts/right_arrow_icon.png" alt="Next" onclick="nextStep(3)" />
                </div>
            </div>
        </div>
    </div>

    <!-- Step 4 (Updated from report_step4.html) -->
    <div id="step4" class="step">
        <div class="container">
            <div class="input-box">
                <h3>Send the report</h3>
                <div class="main-text">How would you like to submit this report?</div>
                <ul class="options">
                    <li>
                        <div class="radio-option">
                            <input type="radio" id="registered" name="report" value="registered">
                            <label for="registered">As a registered user</label>
                        </div>
                        <div class="description">
                            <p>Your username will be publicly visible and your address will be shared with the receiving organization.</p>
                        </div>
                    </li>
                    <li>
                        <div class="radio-option">
                            <input type="radio" id="anonymous" name="report" value="anonymous">
                            <label for="anonymous">As an anonymous</label>
                        </div>
                        <div class="description">
                            <p>No account required. This request will be sent to the receiving organization but you will not receive updates.</p>
                        </div>
                    </li>
                    <li>
                        <div class="radio-option">
                            <input type="radio" id="hide" name="report" value="hide">
                            <label for="hide">Hide your personal information</label>
                        </div>
                        <div class="description">
                            <p>Your username and address will not be public and will be hidden from the receiving organization.</p>
                        </div>
                    </li>
                </ul>

                <div class="action">
                    <div class="previous-button">
                        <img src="../parts/left_arrow_icon.png" alt="Previous" onclick="prevStep(4)" />
                    </div>
                    <div class="finish-next">
                        <div class="finish-text">FINISH</div>
                        <div class="next-button">
                            <img src="../parts/right_arrow_icon.png" alt="Next" onclick="nextStep(4)" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Step 5, confirmation -->
    <div id="step5" class="step">
        <div class="container">
        <h1>Thank you for reporting!</h1>
            <div class="return_home">
            <a class="button" href="../index.html">Return to home page.</a>
            </div>
        </div>
    </div>
    
    <div class="footer">
        Footer
    </div>

    <script>
        function updateStepCSS(stepNumber) {
            // Get the <link> element that dynamically changes
            const cssLink = document.querySelector('.dynamic-css');
            
            // Build the new href based on the step number
            let newHref;
            switch(stepNumber) {
                case 1:
                    newHref = '../parts/style-step1.css';
                    break;
                case 2:
                    newHref = '../parts/style_step2.css';
                    break;
                case 3:
                    newHref = '../parts/style_step3.css';
                    break;
                case 4:
                    newHref = '../parts/style-step4.css';
                    break;
                case 5:
                    newHref = '../parts/confirmation.css';
                    break;
                default:
                    newHref = '../parts/global.css'; // Fallback
            }
            
            // Update the href attribute to point to the new stylesheet
            cssLink.href = newHref;
        }
        
        function nextStep(currentStep) {
            const nextStepElement = document.getElementById(`step${currentStep + 1}`);
            if (nextStepElement) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                nextStepElement.classList.add('active');
                updateStepCSS(currentStep + 1); // Update the CSS for the next step
            }
        }
        
        function prevStep(currentStep) {
            const prevStepElement = document.getElementById(`step${currentStep - 1}`);
            if (prevStepElement) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                prevStepElement.classList.add('active');
                updateStepCSS(currentStep - 1); // Update the CSS for the previous step
            }
        }

        function changeColor(button, category) {
            button.classList.toggle("clicked"); // Toggle the color change
        
            const selectedList = document.getElementById("selected-list");
            const buttonText = `${category} - ${button.innerText}`; // Combine category and button text
        
            if (button.classList.contains("clicked")) {
                // If clicked, add the text
                const listItem = document.createElement("li");
                listItem.textContent = buttonText;
                listItem.setAttribute("id", buttonText); // Use combined text as unique ID
                selectedList.appendChild(listItem);
            } else {
                // If unclicked, remove the text
                const listItem = document.getElementById(buttonText);
                if (listItem) {
                    selectedList.removeChild(listItem);
                }
            }
        }

        // Step 3 functions
        function selectOption(selectedButton) {
            const buttons = document.querySelectorAll('.option-button');
            buttons.forEach(button => {
                button.classList.remove('active');
                button.querySelector('i').classList.replace('fa-arrow-left', 'fa-arrow-right');
            });
            selectedButton.classList.add('active');
            selectedButton.querySelector('i').classList.replace('fa-arrow-right', 'fa-arrow-left');
            
            const selectedOptionText = selectedButton.textContent.trim();

            document.getElementById('dynamicHeading').textContent = `Selected Option: ${selectedOptionText}`;
            document.getElementById('contentContainer').style.display = 'block';
            document.getElementById('messageBox').classList.add('selected');
        } // End of Step 3 functions
        
        function toggleInstructions(step) {
            const overlay = document.getElementById(`instructions-overlay-step${step}`);
            overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';
        }


        window.onload = function() {
            // Get the current URL hash (the part after the #)
            const urlHash = window.location.hash;

            // Check if there's a hash part in the URL
            if (urlHash) {
                // Remove the '#' and decode the URI component (to handle any encoded characters)
                const address = decodeURIComponent(urlHash.substring(1));

                // Set the address in the first input field
                const addressInput = document.getElementById('addressInput');
                addressInput.value = address;
            } else {
                // If no address in the URL, you can set a default value
                const addressInput = document.getElementById('addressInput');
                addressInput.value = "Street xx, 13100 Hml"; // Default value
            }
        };
    </script>
</body>
</html>
